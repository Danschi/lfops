- block:

  - name: 'setenforce {{ selinux__state }}'
    ansible.posix.selinux:
      policy: 'targeted'
      state: '{{ selinux__state }}'
    vars:
      ansible_python_interpreter: '/usr/libexec/platform-python'

  tags:
    - 'selinux'
    - 'selinux:state'


- block:

  - name: 'setsebool -P ...'
    ansible.posix.seboolean:
      name: '{{ item.key }}'
      state: '{{ item.value }}'
      persistent: true
    loop: '{{ selinux__booleans__combined_var }}'
    vars:
      ansible_python_interpreter: '/usr/libexec/platform-python'
    # ignore errors if selinux is disabled
    failed_when:
      - 'sshd__seport_result["failed"] is defined'
      - 'sshd__seport_result["failed"]'
      - 'not "SELinux is disabled on this host." in sshd__seport_result["msg"]'

  tags:
    - 'selinux'
    - 'selinux:booleans'
