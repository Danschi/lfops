- ansible.builtin.debug:
    msg:
      - 'grub-password-configure.yml'

- ansible.builtin.shell: "echo -e '{{ stig__grub2_password }}\n{{ stig__grub2_password }}' | LC_ALL=C /usr/bin/grub2-mkpasswd-pbkdf2 | awk '/hash of / {print $NF}'"
  register: 'grub2_password_hashed'

- ansible.builtin.copy:
    # use lineinfile?
    dest: '/boot/grub2/user.cfg'
    content: '"GRUB2_PASSWORD={{ grub2_password_hashed.stdout }}"'
  notify:
    - 'grub2-mkconfig BIOS'
    - 'grub2-mkconfig EFI'
