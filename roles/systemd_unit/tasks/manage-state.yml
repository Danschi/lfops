- name: 'systemctl {{ item["enabled"] | d(true) | bool | ternary("enable", "disable") }} {{ item["name"] }}.service'
  ansible.builtin.systemd:
    name: '{{ item["name"] }}.service'
    enabled: '{{ item["enabled"] | d(true) }}'

- name: 'systemctl {{ (item["state"] | d("started"))[:-2] }} {{ item["name"] }}.service'
  ansible.builtin.systemd:
    name: '{{ item["name"] }}.service'
    state: '{{ item["state"] | d("started") }}'
  when:
    - 'item["state"] | d("started") not in ["present", "absent"]'
