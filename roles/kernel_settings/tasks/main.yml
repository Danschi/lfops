- block:

  - ansible.builtin.debug:
      msg:
        - 'Combined sysctl:'
        - '{{ kernel_settings__sysctl__combined_var }}'
        - 'Combined sysfs:'
        - '{{ kernel_settings__sysfs__combined_var }}'
        - 'Combined systemd_cpu_affinity: {{ kernel_settings__combined_systemd_cpu_affinity }}'
        - 'Combined transparent_hugepages: {{ kernel_settings__combined_transparent_hugepages }}'
        - 'Combined transparent_hugepages_defrag: {{ kernel_settings__combined_transparent_hugepages_defrag }}'

  - name: 'Use fedora.linux_system_roles.kernel_settings role to configure the kernel settings'
    include_role:
      name: 'fedora.linux_system_roles.kernel_settings'
    vars:
      kernel_settings_sysctl: '{{ kernel_settings__sysctl__combined_var }}'
      kernel_settings_sysfs: '{{ kernel_settings__sysfs__combined_var }}'
      kernel_settings_transparent_hugepages: '{{ kernel_settings__combined_transparent_hugepages }}'
      kernel_settings_transparent_hugepages_defrag: '{{ kernel_settings__combined_transparent_hugepages_defrag }}'
      ansible_python_interpreter: '/usr/libexec/platform-python'

  - ansible.builtin.debug:
      msg: 'Please restart the server manually to apply new kernel settings.'
    when: 'kernel_settings_reboot_required is defined and kernel_settings_reboot_required | bool'

  tags:
    - 'kernel_settings'
