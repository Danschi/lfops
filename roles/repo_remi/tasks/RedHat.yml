- block:

  - name: 'deploy /etc/pki/rpm-gpg/RPM-GPG-KEY-remi.el8'
    copy:
      src: 'RedHat8/etc/pki/rpm-gpg/RPM-GPG-KEY-remi.el8'
      dest: '/etc/pki/rpm-gpg/RPM-GPG-KEY-remi.el8'
  tags:
    - 'repo_remi'


- block:

  - name: 'dnf module reset php -y'
    command: 'dnf module reset php -y'
    args:
      warn: false # https://github.com/ansible/ansible/issues/64852
    register: 'repo_remi__dnf_module_reset_php_result'
    changed_when: '"Nothing to do" not in repo_remi__dnf_module_reset_php_result.stdout'

  - name: "dnf module enable php:remi-{{ repo_remi__enabled_php_version }} -y"
    command: "dnf module enable php:remi-{{ repo_remi__enabled_php_version }} -y"
    args:
      warn: false # https://github.com/ansible/ansible/issues/64852
    register: 'repo_remi__dnf_module_enable_php_result'
    changed_when: '"Nothing to do" not in repo_remi__dnf_module_enable_php_result.stdout'

  when: 'repo_remi__enabled_php_version is defined'
  tags:
    - 'repo_remi'


- block:

  - name: 'dnf module reset redis -y'
    command: 'dnf module reset redis -y'
    args:
      warn: false # https://github.com/ansible/ansible/issues/64852
    register: 'repo_remi__dnf_module_enable_redis_result'
    changed_when: '"Nothing to do" not in repo_remi__dnf_module_enable_redis_result.stdout'

  - name: 'dnf module enable redis:remi-{{ repo_remi__enabled_redis_version }} -y'
    command: 'dnf module enable redis:remi-{{ repo_remi__enabled_redis_version }} -y'
    args:
      warn: false # https://github.com/ansible/ansible/issues/64852
    register: 'repo_remi__dnf_module_enable_redis_result'
    changed_when: '"Nothing to do" not in repo_remi__dnf_module_enable_redis_result.stdout'

  when: 'repo_remi__enabled_redis_version is defined'
  tags:
    - 'repo_remi'
