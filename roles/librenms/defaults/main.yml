librenms__config_auth_mechanism: 'mysql'
librenms__config_update_channel: 'release'
librenms__database_host: 'localhost'
librenms__database_name: 'librenms'

# -----------------------------------------------------------------------------

librenms__apache_httpd__vhosts__dependent_var:
  - by_role: 'librenms'
    enabled: true
    filename: 'librenms'
    state: 'present'
    type: 'app'

    # TODO
    # allowed_file_extensions:
    #   - 'css'
    #   - 'gif'
    #   - 'html?'
    #   - 'ico'
    #   - 'jpe?g'
    #   - 'js'
    #   - 'mp4'
    #   - 'pdf'
    #   - 'php'
    #   - 'png'
    #   - 'svg'
    #   - 'ttf'
    #   - 'txt'
    #   - 'woff2?'

    allowed_http_methods:
      - 'DELETE'
      - 'GET'
      - 'OPTIONS'
      - 'POST'
      - 'PUT'

    authz_file_extensions: |-
      Require all granted

    authz_document_root: |-
      Require all granted

    virtualhost_port: 80

    conf_allow_override: 'All' # TODO
    conf_custom_log_format: 'combined'
    conf_directory_index: 'index.php index.html index.htm'
    conf_document_root: '/opt/librenms/html'
    conf_server_name: '{{ librenms__fqdn }}'

    php_set_handler: 'SetHandler "proxy:unix:/run/php-fpm/librenms.sock|fcgi://localhost"'

    raw: !unsafe |-
      AllowEncodedSlashes NoDecode


librenms__mariadb_server__databases__dependent_var:
  '{{ librenms__database_name }}':
    collation: 'utf8mb4_unicode_ci'
    encoding: 'utf8mb4'
    state: 'present'

librenms__mariadb_server__users__dependent_var:
  '{{ librenms__database_login.username }}@{{ librenms__database_host }}':
    username: '{{ librenms__database_login.username }}'
    password: '{{ librenms__database_login.password }}'
    host: '{{ librenms__database_host }}'
    priv:
      - '{{ librenms__database_name }}.*:ALL'
    state: 'present'


librenms__php__fpm_pools__dependent_var:
  librenms:
    by_role: 'librenms'
    user: 'librenms'
    group: 'librenms'
    raw: |-
      env[PATH] = /usr/local/bin:/usr/bin:/bin

librenms__php__modules__dependent_var:
  php-curl:
    state: 'present'
  php-gd:
    state: 'present'
  php-json:
    state: 'present'
  php-ldap:
    state: 'present'
  php-mbstring:
    state: 'present'
  php-mysqlnd:
    state: 'present'
  php-process:
    state: 'present'
  php-snmp:
    state: 'present'
  php-xml:
    state: 'present'
  php-zip:
    state: 'present'
