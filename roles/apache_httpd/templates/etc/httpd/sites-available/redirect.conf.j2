# {{ ansible_managed }}
# 2022102501
# Redirect vHost
{% if item['by_role'] | d() %}
# Generated by Ansible role: {{ item['by_role'] }}
{% endif %}

<VirtualHost {{ item['virtualhost_ip'] | d('*') }}:{{ item['virtualhost_port'] | d(80) }}>
    ServerName {{ item['conf_server_name'] }}
{% if item['conf_server_alias'] is defined and item['conf_server_alias'] | length %}
    ServerAlias {{ item['conf_server_alias'] }}
{% endif %}
    RewriteEngine On
{% if item['raw'] | d() %}
# raw content
{{ item['raw'] }}
{% else %}
    RewriteCond %{REQUEST_URI} !^/\.well\-known/acme\-challenge/
    RewriteRule ^(.*)$ https://%{HTTP_HOST}$1 [redirect=301,last,noescape]
{% endif %}
</VirtualHost>
