#jinja2:block_start_string:'[%', block_end_string:'%]'
# {{ ansible_managed }}
# 2024062101
[% if item['by_role'] | d() %]
# Generated by Ansible role: {{ item['by_role'] }}
[% endif %]

# log_config_module
# https://httpd.apache.org/docs/2.4/mod/mod_log_config.html#formats
# %b: Size of response in bytes, excluding HTTP headers. In CLF format, i.e. a '-' rather than a 0 when no bytes are sent.
# %D: The time taken to serve the request, in microseconds.
# %h: Remote hostname. Will log the IP address if HostnameLookups is set to Off, which is the default.
# %l: Remote logname (from identd, if supplied). This will return a dash unless mod_ident is present and IdentityCheck is set On.
# %m: The request method.
# %O: Bytes sent, including headers. May be zero in rare cases such as when a request is aborted before a response is sent. You need to enable mod_logio to use this.
# %p: The canonical port of the server serving the request.
# %q: The query string (prepended with a ? if a query string exists, otherwise an empty string)
# %r: First line of request, in the format "GET / HTTP/1.1"
# %s: Status. For requests that have been internally redirected, this is the status of the original request. Use %>s for the final status.
# %>s: Status, e.g. "304". For requests that have been internally redirected, this is the status of the original request. Use %>s for the final status.
# %T: The time taken to serve the request, in seconds.
# %t: Time the request was received, in the format [18/Sep/2011:19:18:28 -0400]. The last number indicates the timezone offset from GMT
# %u: Remote user if the request was authenticated. May be bogus if return status (%s) is 401 (unauthorized).
# %U: The URL path requested, not including any query string.
# %v: The canonical ServerName of the server serving the request.
# "%{User-Agent}i\": "Mozilla/5.0 (X11; Fedora; Linux x86_64; rv:89.0) Gecko/20100101 Firefox/89.0"

# %s, %U, %T, %D, and %r look at the original request while all others look at the final request.

# Common Log Format (CLF)
LogFormat "%h %l %u %t \"%r\" %>s %b" common

# Common Log Format with Virtual Host
LogFormat "%v %h %l %u %t \"%r\" %>s %b" vhost_common

# NCSA extended/combined log format
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" combined

# Referer log format
LogFormat "%{Referer}i -> %U" referer

# Agent (Browser) log format
LogFormat "%{User-agent}i" agent

# minimum needed for the pre-defined fail2ban apache filters
# 10.168.26.7 - - [14/Jul/2021:08:36:49 +0200] "GET / HTTP/1.1" 200 "Mozilla/5.0"
LogFormat "%h %l %u %t \"%r\" %>s \"%{User-Agent}i\"" fail2ban

# Matomo Log Format for https://github.com/matomo-org/matomo-log-analytics
LogFormat "%v %h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" matomo

# GELF Log Format
LogFormat "{\n\
  \"version\": \"1.1\",\n\
  \"host\": \"%v\",\n\
  \"short_message\": \"%r\",\n\
  \"timestamp\": %{%s}t,\n\
  \"level\": 6,\n\
  \"_user_agent\": \"%{User-Agent}i\",\n\
  \"_remote_hostname\": \"%h\",\n\
  \"_duration_usec\": %D,\n\
  \"_duration_sec\": %T,\n\
  \"_request_size_byte\": %O,\n\
  \"_http_status_orig\": %s,\n\
  \"_http_status\": %>s,\n\
  \"_http_request_url\": \"%U\",\n\
  \"_http_query\": \"%q\",\n\
  \"_http_method\": \"%m\",\n\
  \"_http_referer\": \"%{Referer}i\",\n\
  \"_http_x_forwarded_for\": \"%{X-Forwarded-For}i\",\n\
  \"_from_apache\": \"true\"\n\
}" gelf
