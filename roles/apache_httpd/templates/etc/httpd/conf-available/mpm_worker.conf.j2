# {{ ansible_managed }}
# 2022082401
{% if item.value.by_role|d() %}
# Generated by Ansible role: {{ item.value.by_role }}
{% endif %}

# threaded/hybrid server

# StartServers: initial number of server processes to start
# MinSpareThreads: minimum number of worker threads which are kept spare
# MaxSpareThreads: maximum number of worker threads which are kept spare
# ThreadLimit: ThreadsPerChild can be changed to this maximum value during a
#             graceful restart. ThreadLimit can only be changed by stopping
#             and starting Apache.
# ThreadsPerChild: constant number of worker threads in each server process
# MaxRequestWorkers: maximum number of threads
# MaxConnectionsPerChild: maximum number of requests a server process serves

# mpm_worker_module
StartServers            {{ apache_httpd__conf_mpm_worker_start_servers | d(3) }}
MinSpareThreads         {{ apache_httpd__conf_mpm_worker_min_spare_threads | d(75) }}
MaxSpareThreads         {{ apache_httpd__conf_mpm_worker_max_spare_threads | d(250) }}
ThreadLimit             {{ apache_httpd__conf_mpm_worker_thread_limit | d(64) }}
ThreadsPerChild         {{ apache_httpd__conf_mpm_worker_threads_per_child | d(25) }}
MaxRequestWorkers       {{ apache_httpd__conf_mpm_worker_max_request_workers | d(400) }}
MaxConnectionsPerChild  {{ apache_httpd__conf_mpm_worker_max_connections_per_child | d(0) }}

{% if apache_httpd__conf_mpm_worker_max_request_workers / apache_httpd__conf_mpm_worker_threads_per_child | int > 16 %}
# ServerLimit: Upper limit on configurable number of processes.
# This directive in combination with ThreadLimit sets the maximum configured value for
# MaxRequestWorkers for the lifetime of the Apache httpd process.
# ServerLimit is a hard limit on the number of active child processes, and must be greater than or
# equal to the MaxRequestWorkers directive divided by the ThreadsPerChild directive.
# With worker, use this directive only if your MaxRequestWorkers and ThreadsPerChild settings
# require more than 16 server processes (default). Do not set the value of this directive any
# higher than the number of server processes required by what you may want for
# MaxRequestWorkers and ThreadsPerChild.
ServerLimit             {{ apache_httpd__conf_mpm_worker_max_request_workers / apache_httpd__conf_mpm_worker_threads_per_child | round }}
{% endif %}

{{ item.value.raw|d() }}
